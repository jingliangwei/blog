# SSRF漏洞

先参考

- [SSRF漏洞（原理、挖掘点、漏洞利用、修复建议）](https://www.cnblogs.com/miruier/p/13907150.html)
- [SSRF漏洞原理攻击与防御(超详细总结)](https://blog.csdn.net/qq_43378996/article/details/124050308)

## SSRF漏洞利用

### SSRF简介、成因与危害

SSRF(Server-Side Request Forgery，服务器端请求伪造)是一种由攻击者构造请求，由服务端发起请求的安全漏洞。一般情况下，SSRF攻击的目标是外网无法访问的内部系统（正因为请求是由服务端发起的，所以服务端能够请求到与自身相连而与外网隔离的内部系统）。

SSRF形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。

SSRF的危害有：

1. 能扫描内部网络，获取端口服务信息
2. 攻击运行在内网或本地的应用程序
3. 对内网web应用进行指纹识别（访问默认文件）
4. 对内部主机和端口发送请求包进行攻击
5. 利用file协议读取本地文件

### SSRF的挖掘与利用

常见的可能出现SSRF漏洞的情况有：

1. 社交分享功能：获取超链接的标题等内容进行显示
2. 转码服务：通过url地址把原地址的网页调优使其适合手机屏幕浏览
3. 在线翻译：给网址翻译对应网页的内容
4. 图片加载、下载：例如富文本编辑器中的点击下载图片到本地，通过url地址加载或下载图片
5. 图片、文章收藏功能：大多会取url地址中的title以及文本的内容作为显示以求一个好的用户体验
6. 云服务厂商：会远场执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行SSRF测试
7. 网站采集：网站抓取的地方，一些网站会针对你输入的url进行一些信息采集工作
8. 数据库内置功能：数据库的函数比如mongodb的`copyDatabase`函数
9. 邮件系统：比如接受邮件服务器地址
10. 编码处理、属性信息处理、文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等
11. 未公开的api实现以及其他拓展调用url的功能：可以利用google语法加上这些关键字去寻找SSRF漏洞
12. 从远程服务器请求资源：使用了xml引擎对象的地方如wordpress的xmlrpc.php

## SSRF实例与进阶

下面记录成功复现的SSRF漏洞实例。

### 利用url伪协议

新建 `ssrf.php` 文件并启动服务 `php -S localhost:8080`

```php
<?php
function curl($url){  
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_HEADER, 0);
    curl_exec($ch);
    curl_close($ch);
}

$url = $_GET['url'];
curl($url);  
?>
```

在终端通过 `curl -v localhost:8080/ssrf.php?url=file:///path/to/flag` 可以读取文件内容。
